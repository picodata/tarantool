sudo: false
services:
  - docker

language: cpp

# default values
os: linux
compiler: gcc

osx_image: xcode10.2

cache:
    directories:
      - $HOME/.cache

git:
    depth: 100500

env: >
    TEST_RUN_EXTRA_PARAMS="-j 1"
jobs:
    include:
      # Testing targets (just run tests on Debian Stretch or OS X).
      - name: "RelWithDebInfo build + test (Linux, gcc)"
        env: TARGET=test
      - name: RelWithDebInfo build + test (Linux, clang)
        env: TARGET=test
        compiler: clang
      # CentOS
      - name: "CentOS 6 build + deploy RPM"
        env: OS=el DIST=6
      - name: "CentOS 7 build + test + deploy RPM"
        env: OS=el DIST=7
      - name: "CentOS 8 build + test + deploy RPM"
        env: OS=el DIST=8
      # Fedora
      - name: "Fedora 28 build + test + deploy RPM"
        env: OS=fedora DIST=28
      - name: "Fedora 29 build + test + deploy RPM"
        env: OS=fedora DIST=29
      - name: "Fedora 30 build + test + deploy RPM"
        env: OS=fedora DIST=30
      - name: "Fedora 31 build + test + deploy RPM"
        env: OS=fedora DIST=31
      # Ubuntu
      - name: "Ubuntu Trusty (14.04) build + deploy DEB"
        env: OS=ubuntu DIST=trusty
      - name: "Ubuntu Xenial (16.04) build + deploy DEB"
        env: OS=ubuntu DIST=xenial
      - name: "Ubuntu Bionic (18.04) build + deploy DEB"
        env: OS=ubuntu DIST=bionic
      - name: "Ubuntu Cosmic (18.10) build + deploy DEB"
        env: OS=ubuntu DIST=cosmic
      - name: "Ubuntu Disco (19.04) build + deploy DEB"
        env: OS=ubuntu DIST=disco
        if: branch = "master"
      - name: "Debian Jessie (8) build + deploy DEB"
        env: OS=debian DIST=jessie
      - name: "Debian Stretch (9) build + deploy DEB"
        env: OS=debian DIST=stretch
      - name: "Debian Buster (10) build + deploy DEB"
        env: OS=debian DIST=buster


script:
  - make -f .travis.mk ${TARGET}

after_success:
  - ls -l build/
  - sudo apt-get install -y expect
  - cp extra/deploy/sftp.sh .
  - sh sftp.sh  

#notifications:
#  email:
#    recipients:
#      - build@tarantool.org
#    on_success: change
#    on_failure: always
